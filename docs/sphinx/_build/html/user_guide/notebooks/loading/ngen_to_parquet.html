
<!DOCTYPE html>


<html lang="en" data-content_root="../../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Example NGEN to Parquet &#8212; TEEHR: Tools for Exploratory Evaluation in Hydrologic Research 0.3.2 documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../../_static/styles/theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="../../../_static/styles/bootstrap.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="../../../_static/styles/pydata-sphinx-theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />

  
  <link href="../../../_static/vendor/fontawesome/6.5.1/css/all.min.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.5.1/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.5.1/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.5.1/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=a746c00c" />
    <link rel="stylesheet" type="text/css" href="../../../_static/graphviz.css?v=eafc0fe6" />
    <link rel="stylesheet" type="text/css" href="../../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css?v=0a3b3ea7" />
    <link rel="stylesheet" type="text/css" href="../../../_static/css/teehr.css?v=ab7696e0" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../../_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae" />
<link rel="preload" as="script" href="../../../_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae" />
  <script src="../../../_static/vendor/fontawesome/6.5.1/js/all.min.js?digest=8d27b9dea8ad943066ae"></script>

    <script src="../../../_static/documentation_options.js?v=71d9d8e6"></script>
    <script src="../../../_static/doctools.js?v=888ff710"></script>
    <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../_static/design-tabs.js?v=36754332"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'user_guide/notebooks/loading/ngen_to_parquet';</script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="NWM Point Data Loading" href="point_loading_example.html" />
    <link rel="prev" title="Download NWM v2.1 Retrospective Data" href="load_retrospective.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a id="pst-skip-link" class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <header class="bd-header navbar navbar-expand-lg bd-navbar">
<div class="bd-header__inner bd-page-width">
  <label class="sidebar-toggle primary-toggle" for="__primary">
    <span class="fa-solid fa-bars"></span>
  </label>
  
  
  <div class="col-lg-3 navbar-header-items__start">
    
      <div class="navbar-item">

  

<a class="navbar-brand logo" href="../../../index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../../../_static/teehr.png" class="logo__image only-light" alt="TEEHR: Tools for Exploratory Evaluation in Hydrologic Research 0.3.2 documentation - Home"/>
    <script>document.write(`<img src="../../../_static/teehr.png" class="logo__image only-dark" alt="TEEHR: Tools for Exploratory Evaluation in Hydrologic Research 0.3.2 documentation - Home"/>`);</script>
  
  
</a></div>
    
  </div>
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item">
<nav class="navbar-nav">
  <ul class="bd-navbar-elements navbar-nav">
    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../../getting_started/index.html">
                        Getting started
                      </a>
                    </li>
                

                    <li class="nav-item current active">
                      <a class="nav-link nav-internal" href="../../index.html">
                        User Guide
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../../development/index.html">
                        Developer Guide
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../../changelog/index.html">
                        Release Notes
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../../autoapi/index.html">
                        API Reference
                      </a>
                    </li>
                
  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          

 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script>
        </div>
      
      
        <div class="navbar-item">

<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script></div>
      
        <div class="navbar-item"><ul class="navbar-icon-links navbar-nav"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/RTIInternational/teehr" title="GitHub" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fa-brands fa-square-github fa-lg" aria-hidden="true"></i></span>
            <span class="sr-only">GitHub</span></a>
        </li>
</ul></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">

 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script>
    </div>
  

  
    <label class="sidebar-toggle secondary-toggle" for="__secondary" tabindex="0">
      <span class="fa-solid fa-outdent"></span>
    </label>
  
</div>

    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          <div class="navbar-item">
<nav class="navbar-nav">
  <ul class="bd-navbar-elements navbar-nav">
    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../../getting_started/index.html">
                        Getting started
                      </a>
                    </li>
                

                    <li class="nav-item current active">
                      <a class="nav-link nav-internal" href="../../index.html">
                        User Guide
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../../development/index.html">
                        Developer Guide
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../../changelog/index.html">
                        Release Notes
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../../autoapi/index.html">
                        API Reference
                      </a>
                    </li>
                
  </ul>
</nav></div>
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">

<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script></div>
        
          <div class="navbar-item"><ul class="navbar-icon-links navbar-nav"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/RTIInternational/teehr" title="GitHub" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fa-brands fa-square-github fa-lg" aria-hidden="true"></i></span>
            <span class="sr-only">GitHub</span></a>
        </li>
</ul></div>
        
      </div>
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
<nav class="bd-docs-nav bd-links"
     aria-label="Section Navigation">
  <p class="bd-links__title" role="heading" aria-level="1">Section Navigation</p>
  <div class="bd-toc-item navbar-nav"><ul class="current nav bd-sidenav">
<li class="toctree-l1 current active has-children"><a class="reference internal" href="../loading_examples_index.html">Loading Examples</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-1"><i class="fa-solid fa-chevron-down"></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="grid_loading_example.html">NWM Gridded Data Loading</a></li>
<li class="toctree-l2"><a class="reference internal" href="load_retrospective.html">Download NWM v2.1 Retrospective Data</a></li>
<li class="toctree-l2 current active"><a class="current reference internal" href="#">Example NGEN to Parquet</a></li>
<li class="toctree-l2"><a class="reference internal" href="point_loading_example.html">NWM Point Data Loading</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../queries_examples_index.html">Query Examples</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-2"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../queries/ngen_simulation_data_queries.html">NGEN Simulation Data Query Examples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../queries/post_event_data_queries.html">Run Queries Against Post-Event Dataset</a></li>
<li class="toctree-l2"><a class="reference internal" href="../queries/test_queries.html">Test Queries</a></li>
</ul>
</li>
</ul>
</div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">



<nav aria-label="Breadcrumb">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../../../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    
    <li class="breadcrumb-item"><a href="../../index.html" class="nav-link">User Guide</a></li>
    
    
    <li class="breadcrumb-item"><a href="../loading_examples_index.html" class="nav-link">Loading Examples</a></li>
    
    <li class="breadcrumb-item active" aria-current="page">Example...</li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="example-ngen-to-parquet">
<h1>Example NGEN to Parquet<a class="headerlink" href="#example-ngen-to-parquet" title="Link to this heading">#</a></h1>
<p>This is an example notebook to convert ngen catchments, nexus, forcings, and outputs to parquet files for use in TEEHR.  It also loads USGS gage locations and grabs USGS gage data.</p>
<p>This code is not at all DRY at the moment.  There is probably room for tools to handle this process in a standardized yet configurable way.  The NextGen output can vary a lot depending on the model, configuration, etc., so careful planning and understanding of the output would be required. Ideally, code could just be pointed at the <code class="docutils literal notranslate"><span class="pre">realization</span></code>, <code class="docutils literal notranslate"><span class="pre">catchment</span></code> and <code class="docutils literal notranslate"><span class="pre">nexus</span></code> files and everything would be determined programatically from there.  This would require a deeper understanding of the NextGen and BMI, etc. to implement, than we currently have.</p>
<p>Before using any of the code below, you should examine the <code class="docutils literal notranslate"><span class="pre">*.csv</span></code> files carefully as the formats could be different.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%capture</span>
<span class="err">!</span><span class="n">pip</span> <span class="n">install</span> <span class="n">hydrotools</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Need to install TEEHR to avoid this</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;../../src&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">geopandas</span> <span class="k">as</span> <span class="nn">gpd</span>
<span class="kn">import</span> <span class="nn">geoviews</span> <span class="k">as</span> <span class="nn">gv</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">import</span> <span class="nn">hvplot.pandas</span>
<span class="kn">import</span> <span class="nn">cartopy.crs</span> <span class="k">as</span> <span class="nn">ccrs</span>
<span class="kn">from</span> <span class="nn">holoviews</span> <span class="kn">import</span> <span class="n">opts</span>

<span class="kn">import</span> <span class="nn">teehr.loading.usgs</span> <span class="k">as</span> <span class="nn">tlu</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Set some configurations</span>
<span class="n">NGEN_DIR</span> <span class="o">=</span> <span class="s2">&quot;/home/jovyan/shared-readwrite/rti-eval/awi_16_680661_001/ngen/&quot;</span>
<span class="n">NGEN_CONFIG_DIR</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">NGEN_DIR</span><span class="p">,</span> <span class="s2">&quot;config&quot;</span><span class="p">)</span>
<span class="n">NGEN_FORCINGS_DIR</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">NGEN_DIR</span><span class="p">,</span> <span class="s2">&quot;forcings&quot;</span><span class="p">)</span>
<span class="n">NGEN_OUTPUT_DIR</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">NGEN_DIR</span><span class="p">,</span> <span class="s2">&quot;output&quot;</span><span class="p">)</span>

<span class="n">STUDY_DIR</span> <span class="o">=</span> <span class="s2">&quot;/home/jovyan/shared-readwrite/rti-eval/awi_16_680661_001/&quot;</span>
<span class="n">STUDY_TS_DIR</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">STUDY_DIR</span><span class="p">,</span> <span class="s2">&quot;timeseries&quot;</span><span class="p">)</span>
<span class="n">STUDY_GEO_DIR</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">STUDY_DIR</span><span class="p">,</span> <span class="s2">&quot;geo&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<section id="catchment-geojson">
<h2>Catchment GeoJSON<a class="headerlink" href="#catchment-geojson" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">catchment_file_gdf</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">NGEN_CONFIG_DIR</span><span class="p">,</span> <span class="s2">&quot;catchments.geojson&quot;</span><span class="p">))</span>
<span class="n">catchment_file_gdf</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">catchment_file_gdf</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span>
<span class="n">catchment_file_gdf</span> <span class="o">=</span> <span class="n">catchment_file_gdf</span><span class="p">[[</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;geometry&quot;</span><span class="p">]]</span>
<span class="n">catchment_file_gdf</span><span class="o">.</span><span class="n">to_parquet</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">STUDY_GEO_DIR</span><span class="p">,</span> <span class="s2">&quot;cat_geometry.parquet&quot;</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">catchment_crosswalk</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;primary_location_id&quot;</span><span class="p">:</span> <span class="n">catchment_file_gdf</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">],</span> <span class="s2">&quot;secondary_location_id&quot;</span><span class="p">:</span> <span class="n">catchment_file_gdf</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]})</span>
<span class="n">catchment_crosswalk</span><span class="o">.</span><span class="n">to_parquet</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">STUDY_GEO_DIR</span><span class="p">,</span> <span class="s2">&quot;cat_cat_crosswalk.parquet&quot;</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="nexus-geojson">
<h2>Nexus GeoJSON<a class="headerlink" href="#nexus-geojson" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nexus_file_gdf</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">NGEN_CONFIG_DIR</span><span class="p">,</span> <span class="s2">&quot;nexus.geojson&quot;</span><span class="p">))</span>
<span class="n">nexus_file_gdf</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">nexus_file_gdf</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span>
<span class="n">nexus_file_gdf</span> <span class="o">=</span> <span class="n">nexus_file_gdf</span><span class="p">[[</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;geometry&quot;</span><span class="p">]]</span>
<span class="n">nexus_file_gdf</span><span class="o">.</span><span class="n">to_parquet</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">STUDY_GEO_DIR</span><span class="p">,</span> <span class="s2">&quot;nex_geometry.parquet&quot;</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nexus_crosswalk</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;primary_location_id&quot;</span><span class="p">:</span> <span class="n">nexus_file_gdf</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">],</span> <span class="s2">&quot;secondary_location_id&quot;</span><span class="p">:</span> <span class="n">nexus_file_gdf</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]})</span>
<span class="n">nexus_crosswalk</span><span class="o">.</span><span class="n">to_parquet</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">STUDY_GEO_DIR</span><span class="p">,</span> <span class="s2">&quot;nex_nex_crosswalk.parquet&quot;</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="catchment-forcings">
<h2>Catchment Forcings<a class="headerlink" href="#catchment-forcings" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cat_forcing_files</span> <span class="o">=</span> <span class="n">NGEN_FORCINGS_DIR</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">pattern</span><span class="o">=</span><span class="s2">&quot;cat16_cat-*.csv&quot;</span><span class="p">)</span>

<span class="n">cat_dfs</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">cat_forcing_files</span><span class="p">:</span>
    <span class="n">cat_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">parse_dates</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">])</span>
    <span class="n">cat_df</span><span class="p">[</span><span class="s2">&quot;configuration&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;awi_16_680661_001&quot;</span>
    <span class="n">cat_df</span><span class="p">[</span><span class="s2">&quot;variable_name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;precipitation_rate&quot;</span>
    <span class="n">cat_df</span><span class="p">[</span><span class="s2">&quot;reference_time&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">cat_df</span><span class="p">[</span><span class="s2">&quot;measurement_unit&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;mm/hr&quot;</span>
    <span class="n">cat_df</span><span class="p">[</span><span class="s2">&quot;location_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">stem</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">cat_df</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;time&quot;</span><span class="p">:</span><span class="s2">&quot;value_time&quot;</span><span class="p">,</span> <span class="s2">&quot;precip_rate&quot;</span><span class="p">:</span><span class="s2">&quot;value&quot;</span><span class="p">},</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s2">&quot;raise&quot;</span><span class="p">)</span>
    <span class="n">cat_df</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cat_df</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">3600</span>
    <span class="n">cat_df</span> <span class="o">=</span> <span class="n">cat_df</span><span class="p">[[</span><span class="s2">&quot;reference_time&quot;</span><span class="p">,</span> <span class="s2">&quot;location_id&quot;</span><span class="p">,</span> <span class="s2">&quot;value_time&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">,</span> <span class="s2">&quot;variable_name&quot;</span><span class="p">,</span> <span class="s2">&quot;measurement_unit&quot;</span><span class="p">,</span> <span class="s2">&quot;configuration&quot;</span><span class="p">]]</span>
    <span class="c1"># Depending on size may want to write inididual parquet files.</span>
    <span class="c1"># cat_df.to_parquet(Path(STUDY_FORCINGS_DIR, f&quot;{file.stem.split(&#39;_&#39;)[-1]}.parquet&quot;))</span>
    <span class="n">cat_dfs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cat_df</span><span class="p">)</span>
    
<span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">cat_dfs</span><span class="p">)</span><span class="o">.</span><span class="n">to_parquet</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">STUDY_TS_DIR</span><span class="p">,</span> <span class="s2">&quot;catchment_forcings.parquet&quot;</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="catchment-output">
<h2>Catchment Output<a class="headerlink" href="#catchment-output" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cat_output_files</span> <span class="o">=</span> <span class="n">NGEN_OUTPUT_DIR</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">pattern</span><span class="o">=</span><span class="s2">&quot;cat-*.csv&quot;</span><span class="p">)</span>

<span class="n">cat_out_dfs</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">cat_output_files</span><span class="p">:</span>
    <span class="n">cat_out_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
    <span class="n">cat_out_df</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;Time Step&quot;</span><span class="p">:</span><span class="s2">&quot;lead_time&quot;</span><span class="p">,</span><span class="s2">&quot;Time&quot;</span><span class="p">:</span><span class="s2">&quot;value_time&quot;</span><span class="p">,</span> <span class="s2">&quot;Q_OUT&quot;</span><span class="p">:</span> <span class="s2">&quot;value&quot;</span><span class="p">},</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s2">&quot;raise&quot;</span><span class="p">)</span>
    <span class="n">cat_out_df</span><span class="p">[</span><span class="s2">&quot;configuration&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;awi_16_680661_00&quot;</span>
    <span class="n">cat_out_df</span><span class="p">[</span><span class="s2">&quot;location_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">stem</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">cat_out_df</span><span class="p">[</span><span class="s2">&quot;variable_name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;runoff&quot;</span>
    <span class="n">cat_out_df</span><span class="p">[</span><span class="s2">&quot;reference_time&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cat_out_df</span><span class="p">[</span><span class="s2">&quot;value_time&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">cat_out_df</span><span class="p">[</span><span class="s2">&quot;measurement_unit&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;m3/s&quot;</span>
    <span class="n">cat_out_df</span> <span class="o">=</span> <span class="n">cat_out_df</span><span class="p">[[</span><span class="s2">&quot;reference_time&quot;</span><span class="p">,</span> <span class="s2">&quot;location_id&quot;</span><span class="p">,</span> <span class="s2">&quot;value_time&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">,</span> <span class="s2">&quot;variable_name&quot;</span><span class="p">,</span> <span class="s2">&quot;measurement_unit&quot;</span><span class="p">,</span> <span class="s2">&quot;configuration&quot;</span><span class="p">]]</span>
     <span class="c1"># Depending on size may want to write inididual parquet files.</span>
    <span class="c1"># cat_out_df.to_parquet(Path(STUDY_OUTPUT_DIR, f&quot;{file.stem.split(&#39;_&#39;)[-1]}.parquet&quot;))</span>
    <span class="n">cat_out_dfs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cat_out_df</span><span class="p">)</span>
    
<span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">cat_out_dfs</span><span class="p">)</span><span class="o">.</span><span class="n">to_parquet</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">STUDY_TS_DIR</span><span class="p">,</span> <span class="s2">&quot;catchment_simulation.parquet&quot;</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="nexus-output">
<h2>Nexus Output<a class="headerlink" href="#nexus-output" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nexus_output_files</span> <span class="o">=</span> <span class="n">NGEN_OUTPUT_DIR</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">pattern</span><span class="o">=</span><span class="s2">&quot;nex-*.csv&quot;</span><span class="p">)</span>

<span class="n">nex_out_dfs</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">nexus_output_files</span><span class="p">:</span>
    <span class="n">nex_out_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;lead_time&quot;</span><span class="p">,</span><span class="s2">&quot;value_time&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">],</span> <span class="n">parse_dates</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;value_time&quot;</span><span class="p">])</span>
    <span class="n">nex_out_df</span><span class="p">[</span><span class="s2">&quot;configuration&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;awi_16_680661_00&quot;</span>
    <span class="n">nex_out_df</span><span class="p">[</span><span class="s2">&quot;location_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">stem</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">nex_out_df</span><span class="p">[</span><span class="s2">&quot;variable_name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;streamflow&quot;</span>
    <span class="n">nex_out_df</span><span class="p">[</span><span class="s2">&quot;reference_time&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">nex_out_df</span><span class="p">[</span><span class="s2">&quot;value_time&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">nex_out_df</span><span class="p">[</span><span class="s2">&quot;measurement_unit&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;m3/s&quot;</span>
    <span class="n">nex_out_df</span> <span class="o">=</span> <span class="n">nex_out_df</span><span class="p">[[</span><span class="s2">&quot;reference_time&quot;</span><span class="p">,</span> <span class="s2">&quot;location_id&quot;</span><span class="p">,</span> <span class="s2">&quot;value_time&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">,</span> <span class="s2">&quot;variable_name&quot;</span><span class="p">,</span> <span class="s2">&quot;measurement_unit&quot;</span><span class="p">,</span> <span class="s2">&quot;configuration&quot;</span><span class="p">]]</span>
    <span class="c1"># Depending on size may want to write inididual parquet files.</span>
    <span class="c1"># nex_out_df.to_parquet(Path(STUDY_OUTPUT_DIR, f&quot;{file.stem.split(&#39;_&#39;)[-1]}.parquet&quot;))</span>
    <span class="n">nex_out_dfs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nex_out_df</span><span class="p">)</span>
    
<span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">nex_out_dfs</span><span class="p">)</span><span class="o">.</span><span class="n">to_parquet</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">STUDY_TS_DIR</span><span class="p">,</span> <span class="s2">&quot;nexus_simulation.parquet&quot;</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="usgs-gages-and-crosswalk">
<h2>USGS Gages and Crosswalk<a class="headerlink" href="#usgs-gages-and-crosswalk" title="Link to this heading">#</a></h2>
<p>The gage data GeoJSON file <code class="docutils literal notranslate"><span class="pre">usgs_awi_16_680661_001_gages.geojson</span></code> was created manually using QGIS and the nexus and catchment GeoJSON files from the study for this example project, but could be automated in the future.</p>
<p>First the <code class="docutils literal notranslate"><span class="pre">usgs_awi_16_680661_001_gages.geojson</span></code> is converted to parquet and then a crosswalk table is created and also saved as a parquet file.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Convert USGS Gages to Parquet</span>
<span class="n">usgs_gdf</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">STUDY_GEO_DIR</span><span class="p">,</span> <span class="s2">&quot;usgs_awi_16_680661_001_gages.geojson&quot;</span><span class="p">))</span>
<span class="n">usgs_gdf</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;STAID&quot;</span><span class="p">:</span><span class="s2">&quot;id&quot;</span><span class="p">,</span><span class="s2">&quot;STANAME&quot;</span><span class="p">:</span><span class="s2">&quot;name&quot;</span><span class="p">},</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s2">&quot;raise&quot;</span><span class="p">)</span>
<span class="n">usgs_gdf</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;usgs-&quot;</span> <span class="o">+</span> <span class="n">usgs_gdf</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
<span class="n">usgs_gdf</span> <span class="o">=</span> <span class="n">usgs_gdf</span><span class="p">[[</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;geometry&quot;</span><span class="p">]]</span>
<span class="n">usgs_gdf</span><span class="o">.</span><span class="n">to_parquet</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">STUDY_GEO_DIR</span><span class="p">,</span> <span class="s2">&quot;usgs_awi_16_680661_001_geometry.parquet&quot;</span><span class="p">))</span>
<span class="c1"># usgs_gdf</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># This crosswalk list was generated by hand because the hydrofabric for this example </span>
<span class="c1"># does not match the published hydrofabric. In the future, this could be automated </span>
<span class="c1"># based on the hydrofabric data.</span>
<span class="n">nex_location_ids</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;nex-680635&quot;</span><span class="p">,</span>
    <span class="s2">&quot;nex-680639&quot;</span><span class="p">,</span>
    <span class="s2">&quot;nex-680646&quot;</span><span class="p">,</span>
    <span class="s2">&quot;nex-680649&quot;</span><span class="p">,</span>
    <span class="s2">&quot;nex-680892&quot;</span><span class="p">,</span>
    <span class="s2">&quot;nex-680741&quot;</span><span class="p">,</span>
    <span class="s2">&quot;nex-680662&quot;</span>
<span class="p">]</span>
<span class="n">usgs_gage_ids</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;usgs-10154200&quot;</span><span class="p">,</span>
    <span class="s2">&quot;usgs-10155000&quot;</span><span class="p">,</span>
    <span class="s2">&quot;usgs-10155200&quot;</span><span class="p">,</span>
    <span class="s2">&quot;usgs-10155500&quot;</span><span class="p">,</span>
    <span class="s2">&quot;usgs-10156000&quot;</span><span class="p">,</span>
    <span class="s2">&quot;usgs-10157500&quot;</span><span class="p">,</span>
    <span class="s2">&quot;usgs-10163000&quot;</span>
<span class="p">]</span>
<span class="n">usgs_nex_crosswalk</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
    <span class="p">{</span>
        <span class="s2">&quot;primary_location_id&quot;</span><span class="p">:</span> <span class="n">usgs_gage_ids</span><span class="p">,</span>
        <span class="s2">&quot;secondary_location_id&quot;</span><span class="p">:</span> <span class="n">nex_location_ids</span>
    <span class="p">}</span>
<span class="p">)</span>
<span class="n">usgs_nex_crosswalk</span><span class="o">.</span><span class="n">to_parquet</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">STUDY_GEO_DIR</span><span class="p">,</span> <span class="s2">&quot;usgs_nex_crosswalk.parquet&quot;</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="load-usgs-gage-data">
<h2>Load USGS Gage Data<a class="headerlink" href="#load-usgs-gage-data" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Use the TEEHR library to load USGS gage data</span>
<span class="n">usgs_site_codes</span> <span class="o">=</span> <span class="p">[</span><span class="n">v</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;usgs-&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">usgs_nex_crosswalk</span><span class="p">[</span><span class="s2">&quot;primary_location_id&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">to_list</span><span class="p">()]</span>
<span class="n">tlu</span><span class="o">.</span><span class="n">usgs_to_parquet</span><span class="p">(</span>
    <span class="n">sites</span><span class="o">=</span><span class="n">usgs_site_codes</span><span class="p">,</span>
    <span class="n">start_date</span><span class="o">=</span><span class="n">datetime</span><span class="p">(</span><span class="mi">1980</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
    <span class="n">end_date</span><span class="o">=</span><span class="n">datetime</span><span class="p">(</span><span class="mi">1980</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
    <span class="n">output_parquet_dir</span><span class="o">=</span><span class="n">Path</span><span class="p">(</span><span class="n">STUDY_TS_DIR</span><span class="p">),</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="lets-look-at-the-data">
<h2>Lets look at the data<a class="headerlink" href="#lets-look-at-the-data" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tiles</span> <span class="o">=</span> <span class="n">gv</span><span class="o">.</span><span class="n">tile_sources</span><span class="o">.</span><span class="n">OSM</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cat_gdf</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_parquet</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">STUDY_GEO_DIR</span><span class="p">,</span> <span class="s2">&quot;cat_geometry.parquet&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="s2">&quot;EPSG:3857&quot;</span><span class="p">)</span>
<span class="n">catchments</span> <span class="o">=</span> <span class="n">cat_gdf</span><span class="o">.</span><span class="n">hvplot</span><span class="p">(</span><span class="n">crs</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">GOOGLE_MERCATOR</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nex_gdf</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_parquet</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">STUDY_GEO_DIR</span><span class="p">,</span> <span class="s2">&quot;nex_geometry.parquet&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="s2">&quot;EPSG:3857&quot;</span><span class="p">)</span>
<span class="n">nexus</span> <span class="o">=</span> <span class="n">nex_gdf</span><span class="o">.</span><span class="n">hvplot</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;red&quot;</span><span class="p">],</span> <span class="n">crs</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">GOOGLE_MERCATOR</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">usgs_gdf</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_parquet</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">STUDY_GEO_DIR</span><span class="p">,</span> <span class="s2">&quot;usgs_awi_16_680661_001_geometry.parquet&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="s2">&quot;EPSG:3857&quot;</span><span class="p">)</span>
<span class="n">usgs</span> <span class="o">=</span> <span class="n">usgs_gdf</span><span class="o">.</span><span class="n">hvplot</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;green&quot;</span><span class="p">],</span> <span class="n">crs</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">GOOGLE_MERCATOR</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">tiles</span> <span class="o">*</span> <span class="n">catchments</span> <span class="o">*</span> <span class="n">nexus</span> <span class="o">*</span> <span class="n">usgs</span><span class="p">)</span><span class="o">.</span><span class="n">opts</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">600</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>


                </article>
              
              
              
              
              
                <footer class="prev-next-footer">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="load_retrospective.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Download NWM v2.1 Retrospective Data</p>
      </div>
    </a>
    <a class="right-next"
       href="point_loading_example.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">NWM Point Data Loading</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
<div
    id="pst-page-navigation-heading-2"
    class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc" aria-labelledby="pst-page-navigation-heading-2">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#catchment-geojson">Catchment GeoJSON</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#nexus-geojson">Nexus GeoJSON</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#catchment-forcings">Catchment Forcings</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#catchment-output">Catchment Output</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#nexus-output">Nexus Output</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#usgs-gages-and-crosswalk">USGS Gages and Crosswalk</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#load-usgs-gage-data">Load USGS Gage Data</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#lets-look-at-the-data">Lets look at the data</a></li>
</ul>
  </nav></div>

  <div class="sidebar-secondary-item">

  <div class="tocsection sourcelink">
    <a href="../../../_sources/user_guide/notebooks/loading/ngen_to_parquet.ipynb.txt">
      <i class="fa-solid fa-file-lines"></i> Show Source
    </a>
  </div>
</div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../../_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae"></script>
<script src="../../../_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">

  <p class="copyright">
    
      © Copyright 2024 RTI International.
      <br/>
    
  </p>
</div>
      
        <div class="footer-item">

  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.2.6.
    <br/>
  </p>
</div>
      
    </div>
  
  
    <div class="footer-items__center">
      
        <div class="footer-item"><div class="footer-message">
    <a href="https://ciroh.ua.edu/">
        <div class="image">
            <img src="https://ciroh.ua.edu/wp-content/uploads/2022/08/CIROHLogo_200x200.png">
        </div>
    </a>
    <div class="text">
        Funding for this project was provided by the National Oceanic
        & Atmospheric Administration (NOAA), awarded to the Cooperative
        Institute for Research to Operations in Hydrology (CIROH) through
        the NOAA Cooperative Agreement with The University of Alabama (NA22NWS4320003).
    </div>
</div>

<style>
.footer-message {
    display: grid;
    grid-template-columns: 90px 600px;
   }

img {
    width: 95px;
    height:95px;
  }

.text {
font-size: 15px;
text-align: right;
}

</style></div>
      
    </div>
  
  
    <div class="footer-items__end">
      
        <div class="footer-item">
<p class="theme-version">
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.15.2.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>